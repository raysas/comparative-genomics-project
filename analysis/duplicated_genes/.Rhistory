<<<<<<< HEAD
names_to = "gene_type",
values_to = "count")
ggplot(plot_df, aes(x = chromosome, y = count, fill = chromosome, pattern = gene_type)) +
geom_bar_pattern(
stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3,
pattern_fill = "black",
pattern_color = "black",
pattern_density = 0.15,
pattern_spacing = 0.03,
pattern_key_scale_factor = 0.5
) +
scale_fill_manual(values = chrom_colors) +
scale_pattern_manual(values = c("duplicated_genes" = "none", "non_duplicated" = "stripe"),
labels = c("duplicated genes", "non-duplicated")) +
labs(title = "total genes vs duplicated genes per chromosome",
=======
custom_theme
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG, pattern = is_TAG)) +
# geom_bar_pattern(
#   stat = "identity",
#   width = 0.8,
#   color = "white",
#   linewidth = 0.3,
#   pattern_fill = "black",
#   pattern_color = "black",
#   pattern_density = 0.15,
#   pattern_spacing = 0.03,
#   pattern_key_scale_factor = 0.5
# ) +
scale_fill_manual(values = chrom_colors) +
scale_pattern_manual(values = c("TAG duplicated genes" = "none", "non-TAG duplicated genes" = "stripe")) +
labs(title = "TAG duplicated genes vs non-TAG duplicated genes per chromosome",
>>>>>>> general_analysis
x = "chromosome", y = "gene count",
fill = "chromosome", pattern = "gene type") +
base_theme +
custom_theme
<<<<<<< HEAD
families_tag_dup_df <- dup_df %>%
inner_join(families_df, by = c("peptide_id"="geneName")) %>%
left_join(tags_df %>% select(peptide_id, TAG), by = "peptide_id") %>%
mutate(
is_TAG = ifelse(!is.na(TAG) & TAG != 0, TRUE, FALSE),
TAG_id = ifelse(is_TAG, paste0(family, "_TAG", TAG), NA)
)
# -- plot prep
tag_dup_counts <- families_tag_dup_df %>%
group_by(chromosome, is_TAG) %>%
summarise(count = n()) %>%
ungroup()
tag_dup_counts$is_TAG <- ifelse(tag_dup_counts$is_TAG, "TAG duplicated genes", "non-TAG duplicated genes")
chrom_colors<- c("#7A0177","#084594")
=======
>>>>>>> general_analysis
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
<<<<<<< HEAD
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
dup_df<-read.csv('../../output/info/duplicated_genes_info_id50_qcov70_scov70_evalue1e-10_wcol12.csv')
families_df<-read.table('../../output/clusters/protein_families_filtered_blast_results_id50_qcov70_scov70_evalue1e-10_wcol12_network.tsv', header=TRUE)
tags_df<-read.table('../../output/duplication_classes/TAGS/high/TAGs_1.tsv', header=TRUE)
prot_df<-read.csv('../../output/info/protein_info_longest.csv')
total_counts <- prot_df %>% count(chromosome, name = "total_genes")
dup_counts <- dup_df %>% count(chromosome, name = "duplicated_genes")
merged_df <- total_counts %>%
left_join(dup_counts, by = "chromosome") %>%
mutate(
duplicated_genes = ifelse(is.na(duplicated_genes), 0, duplicated_genes),
non_duplicated = total_genes - duplicated_genes
)
plot_df <- merged_df %>%
pivot_longer(cols = c(duplicated_genes, non_duplicated),
names_to = "gene_type",
values_to = "count")
ggplot(plot_df, aes(x = chromosome, y = count, fill = chromosome, pattern = gene_type)) +
geom_bar_pattern(
stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3,
pattern_fill = "black",
pattern_color = "black",
pattern_density = 0.15,
pattern_spacing = 0.03,
pattern_key_scale_factor = 0.5
) +
scale_fill_manual(values = chrom_colors) +
scale_pattern_manual(values = c("duplicated_genes" = "none", "non_duplicated" = "stripe"),
labels = c("duplicated genes", "non-duplicated")) +
labs(title = "total genes vs duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "chromosome", pattern = "gene type") +
base_theme +
custom_theme
tag_dup_counts$is_TAG <- ifelse(tag_dup_counts$is_TAG, "TAG duplicated genes", "non-TAG duplicated genes")
chrom_colors<- c("#7A0177","#084594")
=======
labs(title = "TAG duplicated genes vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "gene type") +
base_theme +
custom_theme
View(res7)
>>>>>>> general_analysis
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
<<<<<<< HEAD
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
chrom_colors<- c("#7A0177","#084594")
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
dup_df<-read.csv('../../output/info/duplicated_genes_info_id50_qcov70_scov70_evalue1e-10_wcol12.csv')
families_df<-read.table('../../output/clusters/protein_families_filtered_blast_results_id50_qcov70_scov70_evalue1e-10_wcol12_network.tsv', header=TRUE)
tags_df<-read.table('../../output/duplication_classes/TAGS/high/TAGs_1.tsv', header=TRUE)
prot_df<-read.csv('../../output/info/protein_info_longest.csv')
total_counts <- prot_df %>% count(chromosome, name = "total_genes")
dup_counts <- dup_df %>% count(chromosome, name = "duplicated_genes")
merged_df <- total_counts %>%
left_join(dup_counts, by = "chromosome") %>%
mutate(
duplicated_genes = ifelse(is.na(duplicated_genes), 0, duplicated_genes),
non_duplicated = total_genes - duplicated_genes
)
plot_df <- merged_df %>%
pivot_longer(cols = c(duplicated_genes, non_duplicated),
names_to = "gene_type",
values_to = "count")
ggplot(plot_df, aes(x = chromosome, y = count, fill = chromosome, pattern = gene_type)) +
geom_bar_pattern(
stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3,
pattern_fill = "black",
pattern_color = "black",
pattern_density = 0.15,
pattern_spacing = 0.03,
pattern_key_scale_factor = 0.5
) +
scale_fill_manual(values = chrom_colors) +
scale_pattern_manual(values = c("duplicated_genes" = "none", "non_duplicated" = "stripe"),
labels = c("duplicated genes", "non-duplicated")) +
labs(title = "total genes vs duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "chromosome", pattern = "gene type") +
base_theme +
custom_theme
families_tag_dup_df <- dup_df %>%
inner_join(families_df, by = c("peptide_id"="geneName")) %>%
left_join(tags_df %>% select(peptide_id, TAG), by = "peptide_id") %>%
mutate(
is_TAG = ifelse(!is.na(TAG) & TAG != 0, TRUE, FALSE),
TAG_id = ifelse(is_TAG, paste0(family, "_TAG", TAG), NA)
)
# -- plot prep
tag_dup_counts <- families_tag_dup_df %>%
group_by(chromosome, is_TAG) %>%
summarise(count = n()) %>%
ungroup()
tag_dup_counts$is_TAG <- ifelse(tag_dup_counts$is_TAG, "TAG duplicated genes", "non-TAG duplicated genes")
chrom_colors<- c("#7A0177","#084594")
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
dup_df<-read.csv('../../output/info/duplicated_genes_info_id30_qcov50_scov50_evalue1e-10_wcol12.csv')
families_df<-read.table('../../output/clusters/protein_families_filtered_blast_results_id30_qcov50_scov50_evalue1e-10_wcol12_network.tsv', header=TRUE)
tags_df<-read.table('../../output/duplication_classes/TAGS/low/TAGs_1.tsv', header=TRUE)
prot_df<-read.csv('../../output/info/protein_info_longest.csv')
total_counts <- prot_df %>% count(chromosome, name = "total_genes")
dup_counts <- dup_df %>% count(chromosome, name = "duplicated_genes")
merged_df <- total_counts %>%
left_join(dup_counts, by = "chromosome") %>%
mutate(
duplicated_genes = ifelse(is.na(duplicated_genes), 0, duplicated_genes),
non_duplicated = total_genes - duplicated_genes
)
plot_df <- merged_df %>%
pivot_longer(cols = c(duplicated_genes, non_duplicated),
names_to = "gene_type",
values_to = "count")
ggplot(plot_df, aes(x = chromosome, y = count, fill = chromosome, pattern = gene_type)) +
geom_bar_pattern(
stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3,
pattern_fill = "black",
pattern_color = "black",
pattern_density = 0.15,
pattern_spacing = 0.03,
pattern_key_scale_factor = 0.5
) +
scale_fill_manual(values = chrom_colors) +
scale_pattern_manual(values = c("duplicated_genes" = "none", "non_duplicated" = "stripe"),
labels = c("duplicated genes", "non-duplicated")) +
labs(title = "total genes vs duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "chromosome", pattern = "gene type") +
base_theme +
custom_theme
# -- plot prep
tag_dup_counts <- families_tag_dup_df %>%
group_by(chromosome, is_TAG) %>%
summarise(count = n()) %>%
ungroup()
tag_dup_counts$is_TAG <- ifelse(tag_dup_counts$is_TAG, "TAG duplicated genes", "non-TAG duplicated genes")
chrom_colors<- c("#7A0177","#084594")
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
stringency='high'
tags_info_df<-read.table(paste0('../../output/statistics/TAGs_spacers_ratios_',stringency,'.tsv'), header=TRUE)
tags_df<-read.table(paste0('../../output/duplication_classes/TAGs/',stringency,'/TAGs_1.tsv'), header=TRUE)
library(ggplot2)
theme_set(theme_minimal(base_size = 14))
this_theme<-theme(
plot.title = element_text(size = 18, hjust = 0.5),
axis.title = element_text(size = 14),
axis.text = element_text(size = 8),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
y_min <- min(tags_info_df$n_TAG_genes)-1000
y_max <- max(tags_info_df$n_TAG_genes)
=======
labs(title = "TAG duplicated genes vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "gene type") +
this_theme
custom_theme <- theme(
plot.title = element_text( size = 18, hjust = 0.5),
axis.title = element_text( size = 14),
axis.text = element_text(size = 12),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(face = "bold")
)
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG duplicated genes vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "gene type") +
base_theme +
custom_theme
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "gene type") +
base_theme +
custom_theme
custom_theme <- theme(
plot.title = element_text( size = 18, hjust = 0.5),
axis.title = element_text( size = 14),
axis.text = element_text(size = 12),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right"
)
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "gene type") +
base_theme +
custom_theme
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
#scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
ggplot(plot_df, aes(x = chromosome, y = count, fill = chromosome, pattern = gene_type)) +
geom_bar_pattern(
stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3,
pattern_fill = "black",
pattern_color = "black",
pattern_density = 0.15,
pattern_spacing = 0.03,
pattern_key_scale_factor = 0.5
) +
scale_fill_manual(values = chrom_colors) +
scale_pattern_manual(values = c("duplicated_genes" = "none", "non_duplicated" = "stripe"),
labels = c("duplicated genes", "non-duplicated")) +
labs(title = "total genes vs duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "chromosome", pattern = "gene type") +
base_theme +
custom_theme
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
ggplot(size_counts_df, aes(x=tag_size, y=count)) +
geom_col(fill = "#ff6f61", color = "white", width = 0.8) +
#geom_line(linewidth = 1, color='#ff9f87') +
geom_point(size = 2) +
geom_text(aes(label = count),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = size_counts_df$tag_size) +
labs(title = "Tandemly Arrayed Genes size distribution (spacer=1)",
x = "TAG size (number of genes)",
y = "number of TAGs") +
this_theme
>>>>>>> general_analysis
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_genes)) +
geom_col(fill = "#007ea7", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "Tandemly Arrayed Genes per spacer",
x = "spacer",
y = "number of TAGs genes") +
this_theme
<<<<<<< HEAD
y_min <- min(tags_info_df$n_TAG_arrays)
=======
ggplot(tag_dup_counts, aes(x = chromosome, y = count, fill = is_TAG)) +
geom_bar(stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3) +
scale_fill_manual(values = chrom_colors) +
labs(title = "TAG vs non-TAG duplicated genes per chromosome",
x = "chromosome", y = "gene count",
fill = "duplicated gene type") +
base_theme +
custom_theme
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_arrays)) +
geom_col(fill = "#007ea7", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "TAGs arrays per spacer",
x = "spacer",
y = "number of TAGs arrays") +
this_theme
>>>>>>> general_analysis
y_min <- min(tags_info_df$n_TAG_arrays)
y_max <- max(tags_info_df$n_TAG_arrays)
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_arrays)) +
geom_col(fill = "#007ea7", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
<<<<<<< HEAD
=======
geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "TAGs arrays per spacer",
x = "spacer",
y = "number of TAGs arrays") +
this_theme
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_arrays)) +
geom_col(fill = "#007ea7", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
>>>>>>> general_analysis
# geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")), vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "TAGs arrays per spacer",
x = "spacer",
y = "number of TAGs arrays") +
this_theme
<<<<<<< HEAD
# -- taking spacer=1
library(dplyr)
tags_df$tag_id <- ifelse(tags_df$TAG != 0,
paste0(tags_df$family, "_TAG", tags_df$TAG),0)
tag_sizes_df<-as.data.frame(table(tags_df$tag_id))
colnames(tag_sizes_df)<-c('tag_id','size')
tag_sizes_df<- tag_sizes_df %>%
filter(tag_id != 0) %>%
arrange(-size)
size_counts_df<-as.data.frame(table(tag_sizes_df$size))
colnames(size_counts_df)<-c('tag_size','count')
size_counts_df$tag_size<-as.numeric(as.character(size_counts_df$tag_size))
size_counts_df<-size_counts_df %>%
arrange(tag_size)
ggplot(size_counts_df, aes(x=tag_size, y=count)) +
geom_col(fill = "#00a8e8", color = "white", width = 0.8) +
=======
ggplot(size_counts_df, aes(x=tag_size, y=count)) +
geom_col(fill = "#ff6f61", color = "white", width = 0.8) +
>>>>>>> general_analysis
#geom_line(linewidth = 1, color='#ff9f87') +
geom_point(size = 2) +
geom_text(aes(label = count),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = size_counts_df$tag_size) +
labs(title = "Tandemly Arrayed Genes size distribution (spacer=1)",
x = "TAG size (number of genes)",
y = "number of TAGs") +
this_theme
<<<<<<< HEAD
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_arrays)) +
geom_col(fill = "#7A0177", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
# geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")), vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "TAGs arrays per spacer",
x = "spacer",
y = "number of TAGs arrays") +
this_theme
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_genes)) +
geom_col(fill = "#7A0177", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "Tandemly Arrayed Genes per spacer",
x = "spacer",
y = "number of TAGs genes") +
this_theme
library(ggplot2)
theme_set(theme_minimal(base_size = 14))
this_theme<-theme(
plot.title = element_text(size = 18, hjust = 0.5),
axis.title = element_text(size = 14),
axis.text = element_text(size = 8),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
y_min <- min(tags_info_df$n_TAG_genes)-1000
y_max <- max(tags_info_df$n_TAG_genes)
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_genes)) +
geom_col(fill = "#7A0177", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "Tandemly Arrayed Genes per spacer",
x = "spacer",
y = "number of TAGs genes") +
this_theme
ggplot(size_counts_df, aes(x=tag_size, y=count)) +
geom_col(fill = "#084594", color = "white", width = 0.8) +
#geom_line(linewidth = 1, color='#ff9f87') +
geom_point(size = 2) +
geom_text(aes(label = count),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = size_counts_df$tag_size) +
labs(title = "Tandemly Arrayed Genes size distribution (spacer=1)",
x = "TAG size (number of genes)",
y = "number of TAGs") +
this_theme
stringency='low'
tags_info_df<-read.table(paste0('../../output/statistics/TAGs_spacers_ratios_',stringency,'.tsv'), header=TRUE)
tags_df<-read.table(paste0('../../output/duplication_classes/TAGs/',stringency,'/TAGs_1.tsv'), header=TRUE)
library(ggplot2)
theme_set(theme_minimal(base_size = 14))
this_theme<-theme(
plot.title = element_text(size = 18, hjust = 0.5),
axis.title = element_text(size = 14),
axis.text = element_text(size = 8),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
y_min <- min(tags_info_df$n_TAG_genes)-1000
y_max <- max(tags_info_df$n_TAG_genes)
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_genes)) +
geom_col(fill = "#7A0177", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "Tandemly Arrayed Genes per spacer",
x = "spacer",
y = "number of TAGs genes") +
this_theme
y_min <- min(tags_info_df$n_TAG_arrays)
y_max <- max(tags_info_df$n_TAG_arrays)
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_arrays)) +
geom_col(fill = "#7A0177", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
# geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")), vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "TAGs arrays per spacer",
x = "spacer",
y = "number of TAGs arrays") +
this_theme
# -- taking spacer=1
library(dplyr)
tags_df$tag_id <- ifelse(tags_df$TAG != 0,
paste0(tags_df$family, "_TAG", tags_df$TAG),0)
tag_sizes_df<-as.data.frame(table(tags_df$tag_id))
colnames(tag_sizes_df)<-c('tag_id','size')
tag_sizes_df<- tag_sizes_df %>%
filter(tag_id != 0) %>%
arrange(-size)
size_counts_df<-as.data.frame(table(tag_sizes_df$size))
colnames(size_counts_df)<-c('tag_size','count')
size_counts_df$tag_size<-as.numeric(as.character(size_counts_df$tag_size))
size_counts_df<-size_counts_df %>%
arrange(tag_size)
ggplot(size_counts_df, aes(x=tag_size, y=count)) +
geom_col(fill = "#084594", color = "white", width = 0.8) +
#geom_line(linewidth = 1, color='#ff9f87') +
geom_point(size = 2) +
geom_text(aes(label = count),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = size_counts_df$tag_size) +
labs(title = "Tandemly Arrayed Genes size distribution (spacer=1)",
x = "TAG size (number of genes)",
y = "number of TAGs") +
this_theme
y_min <- min(tags_info_df$n_TAG_genes)-1000
y_max <- max(tags_info_df$n_TAG_genes)
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_genes)) +
geom_col(fill = "#7A0177", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "Tandemly Arrayed Genes per spacer",
x = "spacer",
y = "number of TAGs genes") +
this_theme
y_min <- min(tags_info_df$n_TAG_arrays)
y_max <- max(tags_info_df$n_TAG_arrays)
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_arrays)) +
geom_col(fill = "#7A0177", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
# geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")), vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "TAGs arrays per spacer",
x = "spacer",
y = "number of TAGs arrays") +
this_theme
stringency='high'
tags_info_df<-read.table(paste0('../../output/statistics/TAGs_spacers_ratios_',stringency,'.tsv'), header=TRUE)
tags_df<-read.table(paste0('../../output/duplication_classes/TAGs/',stringency,'/TAGs_1.tsv'), header=TRUE)
library(ggplot2)
theme_set(theme_minimal(base_size = 14))
this_theme<-theme(
plot.title = element_text(size = 18, hjust = 0.5),
axis.title = element_text(size = 14),
axis.text = element_text(size = 8),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(size = 14),
legend.text = element_text(size = 12)
)
y_min <- min(tags_info_df$n_TAG_genes)-1000
y_max <- max(tags_info_df$n_TAG_genes)
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_genes)) +
geom_col(fill = "#7A0177", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "Tandemly Arrayed Genes per spacer",
x = "spacer",
y = "number of TAGs genes") +
this_theme
y_min <- min(tags_info_df$n_TAG_arrays)
y_max <- max(tags_info_df$n_TAG_arrays)
ggplot(tags_info_df, aes(x = spacer, y = n_TAG_arrays)) +
geom_col(fill = "#7A0177", color = "white", width = 0.8) +
geom_line(linewidth = 1, color='#00a8e8') +
geom_point(size = 2) +
# geom_text(aes(label = paste0(round(ratio_TAG_genes, 3)*100, "%")), vjust = -0.5, size = 4) +
scale_x_continuous(breaks = tags_info_df$spacer) +
coord_cartesian(ylim = c(y_min, y_max)) +
labs(title = "TAGs arrays per spacer",
x = "spacer",
y = "number of TAGs arrays") +
this_theme
# -- taking spacer=1
library(dplyr)
tags_df$tag_id <- ifelse(tags_df$TAG != 0,
paste0(tags_df$family, "_TAG", tags_df$TAG),0)
tag_sizes_df<-as.data.frame(table(tags_df$tag_id))
colnames(tag_sizes_df)<-c('tag_id','size')
tag_sizes_df<- tag_sizes_df %>%
filter(tag_id != 0) %>%
arrange(-size)
size_counts_df<-as.data.frame(table(tag_sizes_df$size))
colnames(size_counts_df)<-c('tag_size','count')
size_counts_df$tag_size<-as.numeric(as.character(size_counts_df$tag_size))
size_counts_df<-size_counts_df %>%
arrange(tag_size)
ggplot(size_counts_df, aes(x=tag_size, y=count)) +
geom_col(fill = "#084594", color = "white", width = 0.8) +
#geom_line(linewidth = 1, color='#ff9f87') +
geom_point(size = 2) +
geom_text(aes(label = count),
vjust = -0.5, size = 4) +
scale_x_continuous(breaks = size_counts_df$tag_size) +
labs(title = "Tandemly Arrayed Genes size distribution (spacer=1)",
x = "TAG size (number of genes)",
y = "number of TAGs") +
this_theme
=======
dup_df<-read.csv('../../output/statistics/duplicated_genes_info.csv')
prot_df<-read.csv('../../output/statistics/protein_info_longest.csv')
edgelist<-read.table('../../output/similarity_edgelists/filtered_blast_results_id30_qcov50_scov50_wcol12_network.tsv')
families_df<-read.table('../../output/clusters/protein_families_filtered_blast_results_id30_qcov50_scov50_wcol12_network.tsv', header=TRUE)
tags_info_df<-read.table('../../output/statistics/TAGs_ratios.tsv', header=TRUE)
tags_df<-read.table('../../output/duplication_classes/TAGS/TAGs_1.tsv', header=TRUE)
colnames(dup_df)
dup_df$chromosome <- factor(dup_df$chromosome)
prot_df$chromosome <- factor(prot_df$chromosome)
dup_full_df <- dup_df[!is.na(dup_df$chromosome) & !is.na(dup_df$start_pos) & !is.na(dup_df$end_pos), ]
# -- sort by chromosome number
dup_df<-dup_df[order(as.numeric(as.character(dup_df$chromosome))), ]
prot_df<-prot_df[order(as.numeric(as.character(prot_df$chromosome))), ]
# -- chormosome colors
chrom_colors <- c(
"#1f77b4", "#1ca2c7", "#17becf", "#2ca02c", "#33cc33",
"#98df8a", "#bcbd22", "#dbdb8d", "#ffbb78", "#ff7f0e",
"#ff6600", "#d62728", "#ff9896", "#c5b0d5", "#9467bd",
"#8c564b", "#c49c94", "#7f7f7f", "#aec7e8", "#393b79"
)
# ---------------- for largesdt family analysis -----------------
# -- get the longest family
count_df<-as.data.frame(table(families_df$family))
colnames(count_df)<-c('family','count')
count_df <-count_df[order(-count_df$count), ]
longest_family<-as.character(count_df$family[1])
longest_family_members<-families_df[families_df$family==longest_family, ]$geneName
# -- the the cluster of the longest family
longest_family_edgelist<-edgelist[edgelist$V1 %in% longest_family_members & edgelist$V2 %in% longest_family_members, ]
library(igraph)
g<-graph_from_data_frame(longest_family_edgelist, directed=FALSE)
# -- large graph can not be visualized
# -- large graph can not be visualized
# -- large graph can not be visualized
# -- large graph can not be visualized
# -- large graph can not be visualized
# -- large graph can not be visualized
# -- large graph can not be visualized
longest_family_members
longest_family_members
# -- save it in text file
write.table(longest_family_members, 'output/gene_lists/largest_family.txt', row.names=FALSE, col.names=FALSE, quote=FALSE)
# -- save it in text file
write.table(longest_family_members, '../../output/gene_lists/largest_family.txt', row.names=FALSE, col.names=FALSE, quote=FALSE)
# -- save thos in prot but not in dup
singletons_df<-prot_df[!prot_df$peptide_id %in% dup_df$peptide_id, ]
head(singletons_df)
dim(singletons_df)
singletons_df$peptide_id
write.csv(singletons_df$peptide_id, '../../output/gene_lists/singleton_genes.csv', row.names=FALSE, col.names = FALSE, quote=FALSE)
write.table(singletons_df$peptide_id, '../../output/gene_lists/singleton_genes.txt', row.names=FALSE, col.names = FALSE, quote=FALSE)
# -- distribution of family members across chromosomes
longest_family_dup_df<-dup_full_df[dup_full_df$peptide_id %in% longest_family_members, ]
table(longest_family_dup_df$chromosome)
# -- how much of them are TAGs
longest_family_tags_df<-tags_df[tags_df$peptide_id %in% longest_family_members, ]
table(longest_family_tags_df$TAG)
dim(longest_family_tags_df)
dim(table(longest_family_tags_df))
length(table(longest_family_tags_df$TAG))
ordered_tags<-longest_family_tags_df[order(longest_family_tags_df$TAG), ]
ordered_tags
order(table(longest_family_tags_df$TAG), decreasing=TRUE)
# -- make a df of TAG pairs (geneA geneB family tag)
tag_pairs_df <- tags_df %>%
inner_join(families_df, by = c("peptide_id" = "geneName")) %>%
select(peptide_id, TAG, family)
# -- make a df of TAG pairs (geneA geneB family tag)
library(dplyr)
tag_pairs_df <- tags_df %>%
inner_join(families_df, by = c("peptide_id" = "geneName")) %>%
select(peptide_id, TAG, family)
tags_df
tag_pairs_df <- tags_df %>%
inner_join(families_df, by = c("peptide_id" = "geneName")) %>%
select(peptide_id, TAG, family)
families_df
tag_pairs_df <- tags_df %>%
inner_join(families_df, by = c("peptide_id" = "geneName"))
tag_pairs_df
# -- make a df of TAG pairs (geneA geneB family tag)
# -- first make a column tag_id that is combination of family and TAG number
tags_df$tag_id <- paste0(tags_df$family, "_TAG", tags_df$TAG)
tags_df
# -- make a df of TAG pairs (geneA geneB family tag)
# -- first make a column tag_id that is combination of family and TAG number
tags_df$tag_id <- ifelse(tags_df$TAG == 0,
paste0(tags_df$family, "_singleton"),
paste0(tags_df$family, "_TAG", tags_df$TAG))
# -- make a df of TAG pairs (geneA geneB family tag)
# -- first make a column tag_id that is combination of family and TAG number
tags_df$tag_id <- ifelse(tags_df$TAG == 0,
0,
paste0(tags_df$family, "_TAG", tags_df$TAG))
tags_df
tags_df$tag_id <- ifelse(tags_df$TAG == 0,
0,
paste0(tags_df$family, "_TAG", tags_df$TAG))
# for every pair having same tag_id, make all combinations
tag_pairs_list <- lapply(unique(tags_df$tag_id[tags_df$tag_id != 0]), function(tid) {
members <- tags_df$peptide_id[tags_df$tag_id == tid]
if (length(members) < 2) return(NULL)
combn(members, 2, FUN = function(x) {
data.frame(
geneA = x[1],
geneB = x[2],
tag_id = tid,
stringsAsFactors = FALSE
)
}, simplify = FALSE)
})
tag_pairs_list
# for every pair having same tag_id, make all combinations
tag_pairs_list <- lapply(unique(tags_df$tag_id[tags_df$tag_id != 0]), function(tid) {
members <- tags_df$peptide_id[tags_df$tag_id == tid]
if (length(members) < 2) return(NULL)
combn(members, 2, FUN = function(x) {
data.frame(
geneA = x[1],
geneB = x[2],
tag_id = tid,
startA = dup_full_df$start_pos[dup_full_df$peptide_id == x[1]],
endA = dup_full_df$end_pos[dup_full_df$peptide_id == x[1]],
startB = dup_full_df$start_pos[dup_full_df$peptide_id == x[2]],
endB = dup_full_df$end_pos[dup_full_df$peptide_id == x[2]],
stringsAsFactors = FALSE
)
}, simplify = FALSE)
})
tag_pairs_df <- do.call(rbind, unlist(tag_pairs_list, recursive = FALSE))
# for every pair having same tag_id, make all combinations
tag_pairs_list <- lapply(unique(tags_df$tag_id[tags_df$tag_id != 0]), function(tid) {
members <- tags_df$peptide_id[tags_df$tag_id == tid]
if (length(members) < 2) return(NULL)
combn(members, 2, FUN = function(x) {
data.frame(
geneA = x[1],
geneB = x[2],
tag_id = tid,
startA = dup_full_df$start_pos[dup_full_df$peptide_id == x[1]],
endA = dup_full_df$end_pos[dup_full_df$peptide_id == x[1]],
strandA= dup_full_df$strand[dup_full_df$peptide_id == x[1]],
startB = dup_full_df$start_pos[dup_full_df$peptide_id == x[2]],
endB = dup_full_df$end_pos[dup_full_df$peptide_id == x[2]],
strandB= dup_full_df$strand[dup_full_df$peptide_id == x[2]],
stringsAsFactors = FALSE
)
}, simplify = FALSE)
})
# for every pair having same tag_id, make all combinations
tag_pairs_list <- lapply(unique(tags_df$tag_id[tags_df$tag_id != 0]), function(tid) {
members <- tags_df$peptide_id[tags_df$tag_id == tid]
if (length(members) < 2) return(NULL)
combn(members, 2, FUN = function(x) {
data.frame(
geneA = x[1],
geneB = x[2],
tag_id = tid,
startA = dup_full_df$start_pos[dup_full_df$peptide_id == x[1]],
endA = dup_full_df$end_pos[dup_full_df$peptide_id == x[1]],
strandA= dup_full_df$strand[dup_full_df$peptide_id == x[1]],
startB = dup_full_df$start_pos[dup_full_df$peptide_id == x[2]],
endB = dup_full_df$end_pos[dup_full_df$peptide_id == x[2]],
strandB= dup_full_df$strand[dup_full_df$peptide_id == x[2]],
stringsAsFactors = FALSE
)
}, simplify = FALSE)
})
tag_pairs_df <- do.call(rbind, unlist(tag_pairs_list, recursive = FALSE))
tag_pairs_df
# -- ordering them by having startA < startB
tag_pairs_df <- tag_pairs_df %>%
rowwise() %>%
mutate(
geneA_final = ifelse(startA < startB, geneA, geneB),
geneB_final = ifelse(startA < startB, geneB, geneA),
startA_final = ifelse(startA < startB, startA, startB),
endA_final = ifelse(startA < startB, endA, endB),
strandA_final = ifelse(startA < startB, strandA, strandB),
startB_final = ifelse(startA < startB, startB, startA),
endB_final = ifelse(startA < startB, endB, endA),
strandB_final = ifelse(startA < startB, strandB, strandA)
) %>%
select(geneA = geneA_final,
geneB = geneB_final,
tag_id,
startA = startA_final,
endA = endA_final,
strandA = strandA_final,
startB = startB_final,
endB = endB_final,
strandB = strandB_final)
tag_pairs_df
# -- making sure all startA < startB
all(tag_pairs_df$startA < tag_pairs_df$startB)
# -- making sure all startA < startB
any(tag_pairs_df$startA < tag_pairs_df$startB)
# -- making sure all startA < startB
sum(tag_pairs_df$startA < tag_pairs_df$startB)
# -- making sure all startA < startB
sum(tag_pairs_df$startA > tag_pairs_df$startB)
# -- making sure all startA < startB
sum(tag_pairs_df$startA == tag_pairs_df$startB)
# -- ordering them by having startA < startB
tag_pairs_df <- tag_pairs_df %>%
rowwise() %>%
mutate(
geneA_final = ifelse(startA < startB, geneA, geneB),
geneB_final = ifelse(startA < startB, geneB, geneA),
startA_final = ifelse(startA < startB, startA, startB),
endA_final = ifelse(startA < startB, endA, endB),
strandA_final = ifelse(startA < startB, strandA, strandB),
startB_final = ifelse(startA < startB, startB, startA),
endB_final = ifelse(startA < startB, endB, endA),
strandB_final = ifelse(startA < startB, strandB, strandA)
) %>%
select(geneA = geneA_final,
geneB = geneB_final,
tag_id,
startA = startA_final,
endA = endA_final,
strandA = strandA_final,
startB = startB_final,
endB = endB_final,
strandB = strandB_final)
# -- making sure all startA < startB
all(tag_pairs_df$startA < tag_pairs_df$startB) # -- there is only one that is =
write.table(tag_pairs_df, '../../output/duplication_classes/TAGs/TAG_gene_pairs.tsv', sep='\t', row.names=FALSE, quote=FALSE)
head(tag_pairs_df)
# -- orientation of TAG pairs
orientation_counts <- tag_pairs_df %>%
rowwise() %>%
mutate(orientation = case_when(
strandA == 1 & strandB == 1 ~ "tandem",
strandA == -1 & strandB == -1 ~ "tandem",
strandA == 1 & strandB == -1 ~ "convergent",
strandA == -1 & strandB == 1 ~ "divergent"
)) %>%
ungroup() %>%
count(orientation)
orientation_counts
# -- adding orientation type of each pair
tag_pairs_df <- tag_pairs_df %>%
rowwise() %>%
mutate(orientation = case_when(
strandA == strandB ~ "tandem",
strandA == 1 & strandB == -1 ~ "convergent",
strandA == -1 & strandB == 1 ~ "divergent",
TRUE ~ NA_character_  # in case there are unexpected strand values
)) %>%
ungroup()
tag_pairs_df
write.table(tag_pairs_df, '../../output/duplication_classes/TAGs/TAG_gene_pairs.tsv', sep='\t', row.names=FALSE, quote=FALSE)
# -- orientation of TAG pairs
orientation_counts <- tag_pairs_df %>%
group_by(orientation) %>%
summarise(count = n()) %>%
arrange(desc(count))
print(orientation_counts)
# -- orientation of TAG pairs with %
orientation_counts <- tag_pairs_df %>%
group_by(orientation) %>%
summarise(count = n()) %>%
arrange(desc(count)) %>%
mutate(percentage = (count / sum(count)) * 100)
print(orientation_counts)
observed <- table(tag_pairs_df$orientation)
observed
# Suppose genome-wide proportions are known:
# tandem = 0.5, convergent = 0.25, divergent = 0.25
expected_prop <- c(tandem = 0.5, convergent = 0.25, divergent = 0.25)
expected <- sum(observed) * expected_prop[names(observed)]
chisq.test(x = observed, p = expected_prop[names(observed)])
dup_full_df
>>>>>>> general_analysis
