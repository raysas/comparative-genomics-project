# -- circos plot
library(circlize)
# Prepare data for circos plot
dup_pairs <- dup_df[, c("gene_id", "chromosome", "start_pos", "end_pos")]
# -- sort by chromosome number
dup_df<-dup_df[order(as.numeric(as.character(dup_df$chromosome))), ]
# -- distribution of duplicated genes by chromosome (stacked bar plot)
chrom_colors <- c(
"#1f77b4", "#1ca2c7", "#17becf", "#2ca02c", "#33cc33",
"#98df8a", "#bcbd22", "#dbdb8d", "#ffbb78", "#ff7f0e",
"#ff6600", "#d62728", "#ff9896", "#c5b0d5", "#9467bd",
"#8c564b", "#c49c94", "#7f7f7f", "#aec7e8", "#393b79"
)
ggplot(dup_df, aes(x = chromosome, fill = chromosome)) +
geom_bar(width = 0.8, color = "white", linewidth = 0.3) +
labs(
title = "Distribution of Duplicated Genes by Chromosome",
x = "Chromosome",
y = "Number of Duplicated Genes",
fill = "Chromosome"
) +
scale_fill_manual(values = chrom_colors) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
axis.title = element_text(face = "bold", size = 14),
axis.text = element_text(size = 12),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(face = "bold"),
plot.margin = margin(10, 10, 10, 10)
)
dup_df
dup_df<-read.csv('../../output/statistics/duplicated_genes_info.csv')
prot_df<-read.csv('../../output/statistics/protein_info_longest.csv')
colnames(dup_df)
dup_df$chromosome <- factor(dup_df$chromosome)
# -- sort by chromosome number
dup_df<-dup_df[order(as.numeric(as.character(dup_df$chromosome))), ]
# -- distribution of duplicated genes by chromosome (stacked bar plot)
chrom_colors <- c(
"#1f77b4", "#1ca2c7", "#17becf", "#2ca02c", "#33cc33",
"#98df8a", "#bcbd22", "#dbdb8d", "#ffbb78", "#ff7f0e",
"#ff6600", "#d62728", "#ff9896", "#c5b0d5", "#9467bd",
"#8c564b", "#c49c94", "#7f7f7f", "#aec7e8", "#393b79"
)
ggplot(dup_df, aes(x = chromosome, fill = chromosome)) +
geom_bar(width = 0.8, color = "white", linewidth = 0.3) +
labs(
title = "Distribution of Duplicated Genes by Chromosome",
x = "Chromosome",
y = "Number of Duplicated Genes",
fill = "Chromosome"
) +
scale_fill_manual(values = chrom_colors) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
axis.title = element_text(face = "bold", size = 14),
axis.text = element_text(size = 12),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(face = "bold"),
plot.margin = margin(10, 10, 10, 10)
)
prot_df$chromosome <- factor(prot_df$chromosome)
prot_df<-prot_df[order(as.numeric(as.character(prot_df$chromosome))), ]
# Count duplicated genes per chromosome
dup_counts <- dup_df %>%
count(chromosome, name = "duplicated_genes")
library(dplyr)
# Count duplicated genes per chromosome
dup_counts <- dup_df %>%
count(chromosome, name = "duplicated_genes")
# Merge both
merged_df <- total_counts %>%
left_join(dup_counts, by = "chromosome") %>%
mutate(
duplicated_genes = ifelse(is.na(duplicated_genes), 0, duplicated_genes),
non_duplicated = total_genes - duplicated_genes
)
# Convert to long format for stacked bars
plot_df <- merged_df %>%
tidyr::pivot_longer(
cols = c(duplicated_genes, non_duplicated),
names_to = "gene_type",
values_to = "count"
)
# Count total genes per chromosome
total_counts <- prot_df %>%
count(chromosome, name = "total_genes")
# Count duplicated genes per chromosome
dup_counts <- dup_df %>%
count(chromosome, name = "duplicated_genes")
# Merge both
merged_df <- total_counts %>%
left_join(dup_counts, by = "chromosome") %>%
mutate(
duplicated_genes = ifelse(is.na(duplicated_genes), 0, duplicated_genes),
non_duplicated = total_genes - duplicated_genes
)
# Convert to long format for stacked bars
plot_df <- merged_df %>%
tidyr::pivot_longer(
cols = c(duplicated_genes, non_duplicated),
names_to = "gene_type",
values_to = "count"
)
# Plot stacked bars
ggplot(plot_df, aes(x = chromosome, y = count, fill = gene_type)) +
geom_bar(stat = "identity", width = 0.8, color = "white", linewidth = 0.3) +
labs(
title = "Total Genes vs Duplicated Genes per Chromosome",
x = "Chromosome",
y = "Gene Count",
fill = "Gene Type"
) +
scale_fill_manual(
values = c("duplicated_genes" = "#d62728",
"non_duplicated"  = "#1f77b4"),
labels = c("Duplicated", "Non-duplicated")
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
axis.title = element_text(face = "bold", size = 14),
axis.text = element_text(size = 12),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(face = "bold")
)
library(ggpattern)
install.packages("ggpattern")  # Uncomment if ggpattern is not installed
install.packages("ggpattern")
library(ggpattern)
ggplot(plot_df,
aes(x = chromosome,
y = count,
fill = chromosome,
pattern = gene_type)) +
geom_bar_pattern(
stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3,
pattern_fill = "black",
pattern_color = "black",
pattern_density = 0.15,
pattern_spacing = 0.03,
pattern_key_scale_factor = 0.5
) +
scale_fill_manual(values = chrom_colors) +
scale_pattern_manual(
values = c(
"duplicated_genes" = "none",
"non_duplicated"   = "stripe"
),
labels = c("Duplicated", "Non-duplicated")
) +
labs(
title = "Total Genes vs Duplicated Genes per Chromosome",
x = "Chromosome",
y = "Gene Count",
fill = "Chromosome",
pattern = "Gene Type"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
axis.title = element_text(face = "bold", size = 14),
axis.text = element_text(size = 12),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(face = "bold")
)
ggplot(plot_df,
aes(x = chromosome,
y = count,
fill = chromosome,
pattern = gene_type)) +
geom_bar_pattern(
stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3,
pattern_fill = "black",
pattern_color = "black",
pattern_density = 0.15,
pattern_spacing = 0.03,
pattern_key_scale_factor = 0.5
) +
scale_fill_manual(values = chrom_colors) +
scale_pattern_manual(
values = c(
"duplicated_genes" = "none",
"non_duplicated"   = "stripe"
),
labels = c("Duplicated", "Non-duplicated")
) +
labs(
title = "Total Genes vs Duplicated Genes per Chromosome",
x = "Chromosome",
y = "Gene Count",
fill = "Chromosome",
pattern = "Gene Type"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
axis.title = element_text(face = "bold", size = 14),
axis.text = element_text(size = 12),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(face = "bold")
)
edgelist<-read.table('../../output/similarity_edgelists/filtered_blast_results_id30_qcov50_scov50_wcol12_network.tsv',header=T,sep='\t')
families_df<-read.table('../../output/clusters/protein_families_id30_qcov50_scov50_wcol12_network.tsv', header=TRUE, sep='\t')
edgelist<-read.table('../../output/similarity_edgelists/filtered_blast_results_id30_qcov50_scov50_wcol12_network.tsv')
head(edgelist)
families_df<-read.table('../../output/clusters/protein_families_id30_qcov50_scov50_wcol12_network.tsv', header=TRUE, sep='\t')
families_df<-read.table('../../output/clusters/protein_families_id30_qcov50_scov50_wcol12_network.tsv', header=TRUE
families_df<-read.table('../../output/clusters/protein_families_id30_qcov50_scov50_wcol12_network.tsv', header=TRUE
families_df<-read.table('../../output/clusters/protein_families_id30_qcov50_scov50_wcol12_network.tsv', header=TRUE)
families_df
families_df<-read.table('../../output/clusters/protein_families_id30_qcov50_scov50_wcol12_network.tsv', header=TRUE)
families_df<-read.table('../../output/clusters/protein_families_filtered_blast_results_id30_qcov50_scov50_wcol12_network.tsv', header=TRUE)
families_df
# -- get the longest family
count_df<-as.data.frame(table(families_df$family_id))
count_df
# -- get the longest family
count_df<-as.data.frame(table(families_df$family))
count_df
colnames(count_df)<-c('family','count')
# -- get the longest family
count_df<-as.data.frame(table(families_df$family)) %>% order(by=Freq, decreasing=TRUE)
# -- get the longest family
count_df<-as.data.frame(table(families_df$family)) %>% order(by=freq, decreasing=TRUE)
count_df<-as.data.frame(table(families_df$family))
count_df
# -- get the longest family
count_df<-as.data.frame(table(families_df$family)) %>% order(by=Freq, decreasing=TRUE)
count_df%>% order(by=Freq, decreasing=TRUE)
colnames(count_df)<-c('family','count')
count_df%>% order(by=count, decreasing=TRUE)
count_df <-count_df[order(-count_df$count), ]
longest_family<-as.character(count_df$family[1])
longest_family
longest_family_members<-families_df[families_df$family==longest_family, ]
longest_family_members
longest_family_members<-families_df[families_df$family==longest_family, ]$geneName
longest_family_members
# -- the the cluster of the longest family
longest_family_edgelist<-edgelist[edgelist$V1 %in% longest_family_members & edgelist$V2 %in% longest_family_members, ]
longest_family_edgelist
library(igraph)
g<-graph_from_data_frame(longest_family_edgelist, directed=FALSE)
ggplot(plot_df,
aes(x = chromosome,
y = count,
fill = chromosome,
pattern = gene_type)) +
geom_bar_pattern(
stat = "identity",
width = 0.8,
color = "white",
linewidth = 0.3,
pattern_fill = "black",
pattern_color = "black",
pattern_density = 0.15,
pattern_spacing = 0.03,
pattern_key_scale_factor = 0.5
) +
scale_fill_manual(values = chrom_colors) +
scale_pattern_manual(
values = c(
"duplicated_genes" = "none",
"non_duplicated"   = "stripe"
),
labels = c("Duplicated", "Non-duplicated")
) +
labs(
title = "Total Genes vs Duplicated Genes per Chromosome",
x = "Chromosome",
y = "Gene Count",
fill = "Chromosome",
pattern = "Gene Type"
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
axis.title = element_text(face = "bold", size = 14),
axis.text = element_text(size = 12),
panel.grid.major.x = element_blank(),
panel.grid.minor = element_blank(),
legend.position = "right",
legend.title = element_text(face = "bold")
)
library(GenomicRanges)
colnames(dup_df)
# Create GRanges object for duplicated genes
GR_duplicated <- GRanges(
seqnames = dup_df$chromosome,
ranges = IRanges(start = dup_df$start_pos, end = dup_df$end_pos),
gene_id = dup_df$gene_id
)
# -- count nas in df$chromosome
sum(is.na(dup_df$chromosome))
sum(is.na(dup_df$start_pos))
sum(is.na(dup_df$end_pos))
# -- all are 460, removing these nas
dup_full_df <- dup_df[!is.na(dup_df$chromosome) & !is.na(dup_df$start_pos) & !is.na(dup_df$end_pos), ]
View(dup_df)
View(dup_df)
GR_duplicated <- GRanges(
seqnames = dup_full_df$chromosome,
ranges = IRanges(start = dup_full_df$start_pos, end = dup_full_df$end_pos),
gene_id = dup_full_df$gene_id
)
GR_duplicated
GR_duplicated <- GRanges(
seqnames = dup_full_df$chromosome,
ranges = IRanges(start = dup_full_df$start_pos, end = dup_full_df$end_pos),
gene_id = dup_full_df$gene_id,
strand = dup_full_df$strand
)
GR_duplicated
# --
query <- GRanges(seqnames = "chr1", ranges = IRanges(120, 220))
findOverlaps(query, GR_duplicated)
# --
query <- GRanges(seqnames = "chr1", ranges = IRanges(120, 2200))
findOverlaps(query, GR_duplicated)
# Convert GRanges to DataFrame
df <- as.data.frame(GR_duplicated)
# ----- 1. CREATE KARYOTYPE FILE -----
karyo <- df %>%
group_by(seqnames) %>%
summarise(chr_start = min(start), chr_end = max(end)) %>%
mutate(chr_id = row_number(), color = "black")
karyotype_lines <- paste(
"chr -",
karyo$seqnames,
karyo$chr_id,
karyo$chr_start,
karyo$chr_end,
karyo$color
)
write.table(
karyotype_lines,
file = "karyotype.txt",
quote = FALSE,
col.names = FALSE,
row.names = FALSE
)
write.table(
karyotype_lines,
file = "files/karyotype.txt",
quote = FALSE,
col.names = FALSE,
row.names = FALSE
)
write.table(
karyotype_lines,
file = "files/karyotype.txt",
quote = FALSE,
col.names = FALSE,
row.names = FALSE
)
# ----- 2. EXPORT DATA VALUES FOR CIRCOS PLOT -----
# Pick a numeric column automatically if you have one
numeric_cols <- names(df)[sapply(df, is.numeric)]
numeric_cols <- setdiff(numeric_cols, c("start", "end", "width"))  # ignore structural columns
if (length(numeric_cols) == 0) {
df$value <- 1   # fallback value if no numeric column exists
value_col <- "value"
} else {
value_col <- numeric_cols[1]   # use the first numeric column
}
circos_data <- df[, c("seqnames", "start", "end", value_col)]
write.table(
circos_data,
file = "files/data.txt",
sep = "\t",
quote = FALSE,
col.names = FALSE,
row.names = FALSE
)
# ----- 3. OUTPUT INFO -----
cat("Files created:\n")
cat(" - files/karyotype.txt\n")
cat(" - files/data.txt (for histogram/scatter/heatmap)\n")
cat("Done.\n")
colnames(mcols(GR_duplicated))
# Write to file
write.table(gff_mcscanx, "files/duplicated.gff",
sep = "\t", quote = FALSE, row.names = FALSE, col.names = FALSE)
# -- make gff3
# Create a minimal MCScanX-compatible GFF
gff_mcscanx <- data.frame(
chr = seqnames(GR_duplicated),
start = start(GR_duplicated),
end = end(GR_duplicated),
gene_id = mcols(GR_duplicated)$gene_id
)
# Write to file
write.table(gff_mcscanx, "files/duplicated.gff",
sep = "\t", quote = FALSE, row.names = FALSE, col.names = FALSE)
# -- make gff3
header='Chr\tGene\tStart\tEnd'
# Create a minimal MCScanX-compatible GFF
gff_mcscanx <- data.frame(
chr = seqnames(GR_duplicated),
start = start(GR_duplicated),
end = end(GR_duplicated),
gene_id = mcols(GR_duplicated)$gene_id
)
# Write to file
write(header, file = "files/duplicated.gff")
write.table(gff_mcscanx, "files/duplicated.gff",
sep = "\t", quote = FALSE, row.names = FALSE, col.names = FALSE)
GR_duplicated <- GRanges(
seqnames = dup_full_df$chromosome,
ranges = IRanges(start = dup_full_df$start_pos, end = dup_full_df$end_pos),
gene_id = dup_full_df$peptide_id,
strand = dup_full_df$strand
)
GR_duplicated
# -- make gff3
header='Chr\tGene\tStart\tEnd'
# Create a minimal MCScanX-compatible GFF
gff_mcscanx <- data.frame(
chr = seqnames(GR_duplicated),
start = start(GR_duplicated),
end = end(GR_duplicated),
gene_id = mcols(GR_duplicated)$gene_id
)
# Write to file
gff_mscanx
# Create a minimal MCScanX-compatible GFF
gff_mcscanx <- data.frame(
chr = seqnames(GR_duplicated),
start = start(GR_duplicated),
end = end(GR_duplicated),
gene_id = mcols(GR_duplicated)$gene_id
)
gff_mcscanx
# Write to file
colnames(gff_mcscanx) <- c("Chr", "Gene", "Start", "End")
write.table(
gff_mcscanx,
file = "files/duplicated_genes_mcscanx.gff",
sep = "\t",
quote = FALSE,
row.names = FALSE,
col.names = TRUE
)
write.table(
gff_mcscanx,
file = "files/duplicated.gff",
sep = "\t",
quote = FALSE,
row.names = FALSE,
col.names = TRUE
)
GR_proteins
# make gr ranges for prot_df
GR_proteins <- GRanges(
seqnames = prot_df$chromosome,
ranges = IRanges(start = prot_df$start_pos, end = prot_df$end_pos),
gene_id = prot_df$peptide_id,
strand = prot_df$strand
)
GR_proteins
# make gr ranges for prot_df
GR_proteins <- GRanges(
seqnames = prot_df$chromosome,
ranges = IRanges(start = prot_df$start_pos, end = prot_df$end_pos),
gene_id = prot_df$peptide_id,
strand = prot_df$strand
)
# make gr ranges for prot_df
prot_full_df <- prot_df[!is.na(prot_df$chromosome) & !is.na(prot_df$start_pos) & !is.na(prot_df$end_pos), ]
View(prot_df)
View(prot_df)
GR_proteins <- GRanges(
seqnames = prot_full_df$chromosome,
ranges = IRanges(start = prot_full_df$start_pos, end = prot_full_df$end_pos),
gene_id = prot_full_df$peptide_id,
strand = prot_full_df$strand
)
GR_proteins
# -- same for proteins
gff_proteins <- data.frame(
chr = seqnames(GR_proteins),
start = start(GR_proteins),
end = end(GR_proteins),
gene_id = mcols(GR_proteins)$gene_id
)
write.table(
gff_proteins,
file = "files/proteins.gff",
sep = "\t",
quote = FALSE,
row.names = FALSE,
col.names = TRUE
)
